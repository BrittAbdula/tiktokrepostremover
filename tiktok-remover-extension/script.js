(() => {
  const e={navigation:{profileButton:'[data-e2e="nav-profile"]',repostTab:['[class*="PRepost"]','[data-e2e="profile-repost-tab"]','a[href*="repost"]','button[data-testid="repost-tab"]'],repostTabFallback:'a, button, div[role="tab"]'},loginStatus:{profileLink:'[data-e2e="nav-profile"]',avatarImage:"img",svgIcon:"svg"},video:{containers:['[class*="DivPlayerContainer"]','[data-e2e="user-post-item"]'],title:['[data-e2e="video-desc"]','[data-e2e="browse-video-desc"]',".video-meta-title",".tt-video-meta-caption",'h1[data-e2e="video-title"]',".video-description",".tt-video-title",'[data-testid="video-desc"]'],author:['[data-e2e="video-author-uniqueid"]','[data-e2e="browse-username"]','[data-e2e="video-author-nickname"]',".author-uniqueid",".username",".user-uniqueid",'[data-testid="video-author"]'],repostButton:['[data-e2e="video-share-repost"]','[class*="repost"]','button[aria-label*="repost" i]'],nextButton:['[data-e2e="arrow-right"]','[class*="arrow-right"]','button[aria-label*="next" i]'],closeButton:['[data-e2e="browse-close"]','[class*="close"]','button[aria-label*="close" i]']},repostStatus:{activeClasses:["reposted","active"],pressedAttribute:"aria-pressed",svgFillSelector:'svg [fill]:not([fill="none"])'}},t={findElement:function(e,t=document){if("string"==typeof e)return t.querySelector(e);if(Array.isArray(e))for(const s of e){const e=t.querySelector(s);if(e)return e}return null},findByText:function(e,t,s=!1){const o=document.querySelectorAll(e);for(const e of o){const o=e.textContent?.trim();if(o)if(s){if(o===t||o.includes(t))return e}else{const s=o.toLowerCase(),i=t.toLowerCase();if(s===i||s.includes(i))return e}}return null},waitForElement:function(e,t=1e4,s=200){const o=Date.now();return new Promise((i,n)=>{const a=()=>{const r=this.findElement(e);return r?i(r):Date.now()-o>=t?n(new Error("Timeout: Element not found")):void setTimeout(a,s)};a()})}};if(window.clearTokExtensionLoaded&&window.clearTokRemover)console.log("ClearTok script already loaded and instance exists, skipping...");else{window.clearTokExtensionLoaded=!0;class s{constructor(){this.selectors=e,this.utils=t,this.isPaused=!1,this.isRunning=!1,this.removedCount=0,this.totalReposts=0,this.currentIndex=0,this.pauseMessageSent=!1,this.messageListenerAdded=!1,this.startTime=null,chrome.runtime.onMessage.hasListeners()&&chrome.runtime.onMessage.removeListener(this.handleMessage.bind(this)),this.messageListenerAdded||(chrome.runtime.onMessage.addListener(this.handleMessage.bind(this)),this.messageListenerAdded=!0)}handleMessage=(e,t,s)=>{"pauseRemoval"===e.action?(this.isPaused=!0,this.pauseMessageSent=!1):"resumeRemoval"===e.action?(this.isPaused=!1,this.pauseMessageSent=!1,this.sendMessage("statusUpdate",{status:"Resuming process..."}),console.log("Process resumed by user")):"checkLoginStatus"===e.action?this.checkLoginStatus():"startRemoval"===e.action?this.start():"navigateToReposts"===e.action&&this.navigateToRepostsTab()};sendMessage(e,t={}){try{const s={action:e,...t,timestamp:Date.now(),instanceId:this.instanceId||"default"};chrome.runtime.sendMessage(s)}catch(e){console.log("Failed to send message:",e)}}checkLoginStatus(){try{const e=this.utils.findElement(this.selectors.loginStatus.profileLink);if(!e)return this.sendMessage("loginStatusUpdate",{isLoggedIn:!1,hasLoginButton:!1,hasUserAvatar:!1,method:"profile-link-not-found"}),void console.log("Profile link not found");const t=e.getAttribute("href");if(!t||!t.includes("/@"))return this.sendMessage("loginStatusUpdate",{isLoggedIn:!1,hasLoginButton:!1,hasUserAvatar:!1,method:"invalid-href"}),void console.log("Invalid href format:",t);const s=t.split("/@")[1],o=s&&s.trim().length>0,i=null!==e.querySelector(this.selectors.loginStatus.avatarImage),n=null!==e.querySelector(this.selectors.loginStatus.svgIcon);this.sendMessage("loginStatusUpdate",{isLoggedIn:o,hasLoginButton:!1,hasUserAvatar:i,method:"username-check",username:o?s.trim():null,hasAvatar:i,hasSvgIcon:n}),console.log("Login status checked:",{isLoggedIn:o,username:o?s.trim():"none",href:t,hasAvatar:i,hasSvgIcon:n})}catch(e){console.error("Error checking login status:",e),this.sendMessage("loginStatusUpdate",{isLoggedIn:!1,hasLoginButton:!1,hasUserAvatar:!1,method:"error",error:e.toString()})}}async sleep(e){return new Promise(t=>{const s=()=>{this.isPaused?setTimeout(s,200):setTimeout(t,e)};s()})}async waitForElement(e,t=1e4,s=200){const o=Date.now();return new Promise((i,n)=>{const a=()=>{for(;this.isPaused;)return void setTimeout(a,s);const r=this.utils.findElement(e);return r?i(r):Date.now()-o>=t?n(new Error("Timeout: Element not found")):void setTimeout(a,s)};a()})}async waitWithProgress(e,t="Waiting"){for(let t=e;t>0;t--){for(;this.isPaused;)this.pauseMessageSent||(this.sendMessage("waiting",{seconds:"paused"}),this.pauseMessageSent=!0),await this.sleep(500);this.sendMessage("waiting",{seconds:t}),await this.sleep(1e3)}}getVideoInfo(){try{const e={title:"",url:window.location.href,author:""},t=this.utils.findElement(this.selectors.video.title);t&&t.textContent.trim()&&(e.title=t.textContent.trim());const s=this.utils.findElement(this.selectors.video.author);if(s&&s.textContent.trim()){let t=s.textContent.trim();t.startsWith("@")||(t="@"+t),e.author=t}if(!e.author&&e.url.includes("/@")){const t=e.url.split("/@");if(t.length>1){const s=t[1].split("/")[0];s&&(e.author="@"+s)}}if(!e.title&&e.url.includes("/video/")){const t=e.url.split("/video/")[1]?.split("?")[0];t&&(e.title=`Video ${t.substring(0,8)}...`)}return e.title.length>50&&(e.title=e.title.substring(0,50)+"..."),e.title||(e.title="Untitled video"),e.author||(e.author="@unknown"),e}catch(e){return console.log("Error getting video info:",e),{title:"Unknown video",url:window.location.href,author:"@unknown"}}}async clickProfileTab(){try{this.sendMessage("statusUpdate",{status:"Navigating to profile..."}),this.checkLoginStatus(),await this.sleep(1e3);return(await this.waitForElement(this.selectors.navigation.profileButton)).click(),console.log("Successfully clicked the 'Profile' button."),this.sendMessage("statusUpdate",{status:"Loading profile page..."}),await this.waitWithProgress(3,"Loading profile"),!0}catch(e){return this.stopScript("The 'Profile' button was not found. Please make sure you are logged in to TikTok.",e),!1}}async clickRepostTab(){try{this.sendMessage("statusUpdate",{status:"Looking for Reposts tab..."});let e=this.utils.findElement(this.selectors.navigation.repostTab);if(e||(e=this.utils.findByText(this.selectors.navigation.repostTabFallback,"repost")),!e)throw new Error("Reposts tab not found");e.click(),console.log("Successfully clicked the 'Reposts' tab."),this.sendMessage("statusUpdate",{status:"Loading reposts..."}),await this.waitWithProgress(3,"Loading reposts"),await this.sleep(2e3);const t=document.querySelectorAll(this.selectors.video.containers.join(", "));if(this.totalReposts=t.length,0===this.totalReposts){const e=Date.now()-this.startTime,t=Math.floor(e/6e4),s=Math.floor(e%6e4/1e3);return this.sendMessage("noRepostsFound",{duration:{total:e,minutes:t,seconds:s}}),!1}return this.sendMessage("updateProgress",{current:0,total:this.totalReposts}),this.sendMessage("statusUpdate",{status:`Found ${this.totalReposts} repost(s) to process`}),console.log(`Found ${this.totalReposts} reposted videos to remove.`),!0}catch(e){return this.stopScript("Error accessing the 'Reposts' tab. Make sure you have reposted videos.",e),!1}}async clickRepostVideo(){try{this.sendMessage("statusUpdate",{status:"Opening first repost..."});return(await this.waitForElement(this.selectors.video.containers)).click(),console.log("Successfully opened the first reposted video."),await this.waitWithProgress(3,"Opening video"),!0}catch(e){return this.stopScript("No reposted videos found or unable to open",e),!1}}async processRepostVideos(){try{let e=0;for(;this.currentIndex<this.totalReposts;){for(;this.isPaused;)await this.sleep(500);this.currentIndex++;const t=this.getVideoInfo();console.log("Processing video:",t),this.sendMessage("updateProgress",{current:this.currentIndex,total:this.totalReposts,title:t.title,author:t.author,url:t.url}),this.sendMessage("statusUpdate",{status:`Processing repost ${this.currentIndex} of ${this.totalReposts}...`});const s=this.utils.findElement(this.selectors.video.repostButton);if(s){if(this.isVideoReposted(s))try{s.click(),this.removedCount++,e++,this.sendMessage("videoRemoved",{index:this.currentIndex,title:t.title,author:t.author,url:t.url}),console.log(`Removed repost from video #${this.currentIndex}:`,t),await this.waitWithProgress(2+2*Math.random(),"Processing removal")}catch(e){console.log(`Failed to remove repost from video #${this.currentIndex}:`,e),this.sendMessage("videoSkipped",{index:this.currentIndex,reason:"failed to click repost button",title:t.title,author:t.author,url:t.url})}else this.sendMessage("videoSkipped",{index:this.currentIndex,reason:"not currently reposted",title:t.title,author:t.author,url:t.url})}else this.sendMessage("videoSkipped",{index:this.currentIndex,reason:"repost button not found",title:t.title,author:t.author,url:t.url});const o=this.utils.findElement(this.selectors.video.nextButton);if(!o||o.disabled){console.log("No more videos to process");break}try{o.click(),console.log("Moved to next reposted video."),await this.sleep(1e3)}catch(e){console.log("Failed to move to next video:",e);break}}await this.closeVideo();const t=Date.now()-this.startTime,s=Math.floor(t/6e4),o=Math.floor(t%6e4/1e3);this.sendMessage("complete",{removedCount:e,duration:{total:t,minutes:s,seconds:o}})}catch(e){this.stopScript("Error during reposted video removal",e)}}isVideoReposted(e){const t="true"===e.getAttribute(this.selectors.repostStatus.pressedAttribute),s=this.selectors.repostStatus.activeClasses.some(t=>e.classList.contains(t)||e.querySelector(`[class*="${t}"]`)),o=window.getComputedStyle(e),i="rgb(255, 255, 255)"!==o.color&&"rgba(255, 255, 255, 1)"!==o.color,n=null!==e.querySelector(this.selectors.repostStatus.svgFillSelector);return console.log("Repost button analysis:",{isPressed:t,hasRepostedClass:s,hasActiveColor:i,hasFilledIcon:n,finalResult:t||s||i||n}),t||s||i||n}async closeVideo(){try{this.sendMessage("statusUpdate",{status:"Closing video player..."});const e=this.utils.findElement(this.selectors.video.closeButton);if(e)e.click(),console.log("Closed video view."),await this.sleep(1e3);else{const e=new KeyboardEvent("keydown",{key:"Escape"});document.dispatchEvent(e),await this.sleep(1e3)}}catch(e){console.log("Error closing the video:",e)}}stopScript(e,t=""){this.isRunning=!1,this.sendMessage("error",{message:e,error:t.toString()}),console.log(`Script stopped: ${e}`,t)}async navigateToRepostsTab(){try{this.sendMessage("statusUpdate",{status:"Navigating to profile and reposts..."});const e=window.location.href;if(!(e.includes("/@")&&!e.includes("/video/"))){if(!await this.clickProfileTab())return void this.sendMessage("statusUpdate",{status:"Unable to navigate to profile"});await this.waitWithProgress(3,"Loading profile")}this.sendMessage("statusUpdate",{status:"Opening reposts tab..."});let t=this.utils.findElement(this.selectors.navigation.repostTab);t||(t=this.utils.findByText(this.selectors.navigation.repostTabFallback,"repost")),t?(t.click(),console.log("Successfully clicked reposts tab"),this.sendMessage("statusUpdate",{status:"Reposts tab opened - You can see the results!"}),setTimeout(()=>{const e=document.querySelectorAll(this.selectors.video.containers.join(", ")).length;0===e?this.sendMessage("statusUpdate",{status:"ðŸŽ‰ All reposts successfully removed!"}):this.sendMessage("statusUpdate",{status:`${e} repost(s) remaining on your profile`})},2e3)):(this.sendMessage("statusUpdate",{status:"Reposts tab not found - please check manually"}),console.log("Reposts tab not found"))}catch(e){console.error("Error navigating to reposts tab:",e),this.sendMessage("statusUpdate",{status:"Error navigating to reposts - please check manually"})}}async start(){if(this.isRunning)console.log("Script is already running.");else{this.isRunning=!0,this.currentIndex=0,this.removedCount=0,this.startTime=Date.now(),console.log("ClearTok script started..."),this.sendMessage("statusUpdate",{status:"Starting removal process..."});try{if(!await this.clickProfileTab())return;if(!await this.clickRepostTab())return;if(!await this.clickRepostVideo())return;await this.processRepostVideos()}catch(e){this.stopScript("Unexpected error in main flow",e)}}}}window.location.hostname.includes("tiktok.com")?(window.clearTokRemover?console.log("ClearTok remover instance already exists, using existing one"):(window.clearTokRemover=new s,window.clearTokRemover.instanceId=`instance_${Date.now()}`,console.log("ClearTok remover instance created with ID:",window.clearTokRemover.instanceId)),setTimeout(()=>{window.clearTokRemover&&window.clearTokRemover.checkLoginStatus()},3e3)):console.log("This script only works on TikTok.com")}"undefined"!=typeof module&&module.exports?module.exports={SELECTORS:e,SelectorUtils:t}:window.TikTokSelectors={SELECTORS:e,SelectorUtils:t};
})();
